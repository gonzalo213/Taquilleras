@model List<Taquilleras.Entities.Transaction>
@using (Html.BeginForm("Find", "Admin", FormMethod.Post))
{
    @Html.DropDownList("Taquilla", (List<SelectListItem>)TempData["TicketOffices"], "Selecciona", new { @class = "form-control" })
    <input type="text" class="form-control" id="dpFilter" name="dpFilter" />
    <div class="row" style="text-align: right ">
        <input type="submit" name="name" value="Buscar" class="btn btn-primary" />
    </div>
}


@if (Model != null)
{
    <div class="row" id="divDetails" style="text-align: right">
        @foreach (Taquilleras.Entities.Transaction transaction in Model)
        {
            <div class="col-sm-4 col-xs-6">@Html.Partial("_Item.cshtml", transaction.TransactionDetail)</div>
        }
    </div>
}
<input type="button" id="btnCancel" value="Click" class="btn btn-primary" />
<input type="button" id="btnApplyChanges" value="Aplicar cambios" class="btn btn-primary" />
<span id="span"></span>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<script>
    $('#dpFilter').datepicker({
        uiLibrary: 'bootstrap4'
    });

    $(function () {
        $("#btnClick").click(function () {
            var url = "@Url.Action("Test","Admin")";
            var fecha = $("#dpFilter").val;
            $.post(url, fecha).done(function (data) {


            });
        });
    });
    $(function (){
        $("#btnApplyChanges").click(function () {
            var jsonStr = ''
            var obj 
            $("#divDetails").find(':input').each(function () {
                var elemento = this;
                if (elemento.value > 0) {
                    if (jsonStr == '') {
                        jsonStr = '{"ClientTransaction":[{"ProducId":"' + elemento.id + '","Value":"' + elemento.value + '"}]}';
                        obj = JSON.parse(jsonStr);
                    }                        
                    else
                        obj['ClientTransaction'].push({ "ProducId": elemento.id, "Value": elemento.value });
                }
            })
     
            $.ajax({
                url: "@Url.Action("Test","Admin")",
                data: { data: JSON.stringify(obj) } ,
                success: function (json) {
                    $("#btnClick").val(json)
                },
                failure: function (response) {
                    alert("Error");
                },
                error: function (response) {
                    alert("Error");
                }

            })
        });
    });
</script>
