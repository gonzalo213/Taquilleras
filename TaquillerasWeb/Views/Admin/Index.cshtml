@model List<Taquilleras.Entities.Transaction>
@using (Html.BeginForm("Find", "Admin", FormMethod.Post))
{
    <h4><strong>Modificacion de Venta</strong></h4>
    <div class="card">
        <div class="card-header">
            <div>
                <input required type="text" class="form-control col-3 offset-9" id="dpFilter" name="dpFilter" placeholder="Selecciona Fecha" />
            </div>
        </div>
        <div class="card-body">
            <blockquote class="blockquote mb-0">
                <div class="input-group mb-0">
                    <div class="input-group-prepend">
                        <input type="submit" name="name" value="Buscar" class="btn btn-outline-info" />
                    </div>
                    @Html.DropDownList("Taquilla", (List<SelectListItem>)TempData["TicketOffices"], "Selecciona Taquilla", new { @class = "form-control", required = "required" })
                </div>
            </blockquote>
        </div>
    </div>

}


@if (Model != null)
{
<div class="row" id="divDetails" >
    @foreach (Taquilleras.Entities.Transaction transaction in Model)
    {
    <div class="card border-info mb-3 mr-5 mt-3" style="max-width: 18rem;">
        <div class="card-header">
            <h6>Turno:<span class="badge badge-dark mr-3"> @transaction.ShiftType.Description</span></h6>
           
            <h6>Nombre Taquillera:<span class="text-black-50">@string.Format("{0} {1} {2}", transaction.BoxOfficeOperator.Name, transaction.BoxOfficeOperator.LastName, transaction.BoxOfficeOperator.LastName2)</span></h6>

        </div>
        <div class="card-body text-info">
            <div class="">@Html.Partial("_Item.cshtml", transaction.TransactionDetail)</div>
        </div>
        <div class="card-footer bg-transparent border-info">
        <h4>Saldo Total<span class="badge badge-success">$@transaction.TotalAmount</span></h4>
        </div>
    </div>

        
    }
</div>
}
<input type="button" id="btnClick" value="Click" class="btn btn-primary" />
<input type="button" id="btnApplyChanges" value="Aplicar cambios" class="btn btn-primary" />
<span id="span"></span>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
<script>
    $('#dpFilter').datepicker({
        uiLibrary: 'bootstrap4'
    });

    $(function () {
        $("#btnClick").click(function () {
            var url = "@Url.Action("Test","Admin")";
            var fecha = $("#dpFilter").val;
            $.post(url, fecha).done(function (data) {


            });
        });
    });

    $(function (){
        $("#btnApplyChanges").click(function () {
            var jsonStr = '';
            $("#divDetails").find(':input').each(function () {
                var elemento = this;
                if (elemento.value > 0) {
                    if (jsonStr == '') {
                        jsonStr = '{"ClientTransaction":[{"ProducId":"' + elemento.id + '","Value":"' + elemento.value + '"}]}';
                        obj = JSON.parse(jsonStr);
                    }
                    else
                        obj['ClientTransaction'].push({ "ProducId": elemento.id, "Value": elemento.value });
                }
            })

            $.ajax({

                url: "@Url.Action("Test","Admin")",
                data: { data: JSON.stringify(obj) },
                contentType: "application/json",
   
                success: function (json) {
                    $("#btnClick").val(json)
                },
                failure: function (response) {
                    alert("Error");
                },
                error: function (response) {
                    alert("Error");
                }

            })
        });
    });
</script>
